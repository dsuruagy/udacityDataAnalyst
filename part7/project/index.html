<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
      .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 2px;
      }
    </style>
    <script type="text/javascript">
    	function draw(data) {
	        "use strict";
	        var margin = 75,
	            width = 1400 - margin,
	            height = 600 - margin;

	        var svg = d3.select("body")
	            .append("svg")
	            .attr("width", width + margin)
	            .attr("height", height + margin)
	            .append('g')
	            .attr('class', 'chart');

	        var meanDelay_extent = d3.extent(data, function(d) {
	        	return d['meanDelay'];
	        });

          // https://stackoverflow.com/questions/23558701/d3-js-line-chart-with-time-on-both-axis
          var xMin = d3.min(data, function(d) {
            return d['depInterval'];
          });

          var xMax = d3.max(data, function(d) {
            return d['depInterval'];
          });

          var scaleInterval = d3.scaleTime()
          .range([margin, width])
          .domain([xMin, xMax]);

    			var scaleDelay = d3.scaleLinear()
                	.range([height, margin])
                	.domain(meanDelay_extent);

    			var timeAxis = d3.axisBottom(scaleInterval)
            .ticks(24)
            .tickFormat(d3.timeFormat("%H:%M"));

    			var delayAxis = d3.axisLeft(scaleDelay);

    			svg.append('g')
    			.attr('class', 'x axis')
    			.attr('transform', "translate(0," + height + ")")
    			.call(timeAxis);

    			svg.append('g')
    			.attr('class', 'y axis')
    			.attr('transform', "translate(" + margin + ",0)")
    			.call(delayAxis);


          var nested = d3.nest()
                      .key(function(d) { return d['Month']})
                      .key(function(d) { return d['depInterval']})
                      .rollup(function(leaves) {
                        return d3.sum(leaves, function(d) { return d['meanDelay']});
                      })
                      .entries(data);

          svg.append("path")
            .data([nested[1]['values']])
            .attr("class", "line")
            .attr("d", d3.line()
              .x(function(d) {
                // debugger;
                return scaleInterval(d3.isoParse(d['key']));
              })
              .y(function(d) {
                return scaleDelay(d['value']);
              })
            );
     }
    </script>
  </head>
<body>
  <script type="text/javascript">
  	var parseHour = d3.timeParse("%H:%M");

    d3.csv("2008-mean.csv", function(d) {
      d['depInterval'] = parseHour(d['depInterval']);
      d['meanDelay'] = +d['meanDelay'];

      return d;
    }, draw);
  </script>
</body>
</html>
